# Docker compose for OkayCMS
## Typical configuration

A typical configuration includes Nginx as a web server and the php-fpm interpreter.
To start the environment, execute the command in the dev directory:
```shell
docker compose up -d
```
Если на машине планируется одновременно запускать несколько проектов на 
основе одного docker-compose.yml, 
Рекомендую указать название проекта:
```shell
docker compose -p okay_develop up -d
```
где «okay_develop» — это название проекта

Также рекомендую, если на машине планируется несколько проектов, 
не заходить на http://localhost:80, http://localhost:81...
Добавьте все хосты в файл хостов по адресу 127.0.0.1 и запустите обратный прокси.
Вот хороший прокси в докер-контейнере. Для запуска в любом каталоге выполните команду:
```shell
docker run -d -p 80:80 -v /var/run/docker.sock:/tmp/docker.sock:ro --net okay_network nginxproxy/nginx-proxy
```
После запуска можно будет получить доступ по http к хосту, указанному в .env VIRTUAL_HOST на порту 80 (независимо от того, какой порт
указано в HTTP_PORT)

## БАЗА ДАННЫХ
При создании контейнера в него заполняется дамп базы данных по умолчанию
(1DB_changes/okay_clean.sql).
Также при каждом поднятии контейнера создается или обновляется менеджер 
панели администратора (admin).
Стандартные данные для входа в админку***admin / 1234***

## изменить размер изображений
Когда база данных с производственного сайта выносится на локальный сервер, 
всегда возникает проблема с исходными изображениями товаров, категорий и т.д.
Поэтому в файле .env можно указать переменную PRODUCTION_DOMAIN, где будет указан домен,
с которого была взята база,
и обрезки изображений будут взяты из этого домена через http. 
Важно: это будет работать только для изображений с измененным размером.
который совпадает с производственным сервером.
Изображения не добавляются в каталог оригиналов на локальном сервере, 
они будут сохранены только в каталоге с измененным размером.

## EmailTesting
Чтобы протестировать электронную почту на локальном сервере и
не отправлять людям настоящие электронные письма, 
введите тестовый адрес электронной почты в поле 
.env TEST_INTERNAL_EMAIL, поэтому все электронные письма будут пересылаться на этот адрес.

## Налаштування Xdebug
Чтобы настроить Xdebug для работы с PHPStorm, выполните следующие действия:

1. Перейдите в «Настройки» > «PHP» > «Серверы» и добавьте сервер.
Хост и порт указаны как в файле .env (VIRTUAL_HOST, HTTP_PORT).
2. Здесь же настраиваем Pathmapping (на сервере корень сайта на хост-машине указывается как /var/www/html)
3. В «Настройки» > «PHP» > «Отладка» > «XDebug» добавьте порт 9001.
4. Перейдите в «Выполнить» > «Редактировать конфигурации» и создайте конфигурацию на основе удаленной отладки PHP.
В поле Сервер укажите созданный выше сервер, в ключе IDE введите PHPSTORM.
Я рекомендую указывать имя как хост:порт.

ConfigurationExamples

![настройки сервера](./source/server_example.png)
![xdebugConfigurationSettings(./source/run_xdebug_example.png)
